<?php
if ((isset($property)) && ($property == 1)) {
    $version = '1.0';
    $author = 'Syamsul Arham';
} else {

    class HCM extends Databases
    {
        const TBLNAME = "hcm";
        const tblview = "view_employees";
        const tblmst = "mst_employees";

        // public $hostname;
        // public $username;
        // public $password;
        // public $database;

        // function __construct($hostname, $username, $password, $database) {
        //   $this->conn = new mysqli($hostname, $username, $password, $database);
        //   if ($this->conn->connect_errno) {
        //       echo "Failed to connect to MySQL: (" . $this->conn->connect_errno . ") " . $this->conn->connect_error;
        //   }
        // }
        // function __construct()
        // {
        // }

        private function get_hcm($email)
        {
            $condition = "email='" . $email . "'";
            $data = $this->get_data(self::tblmst, $condition);
            return $data;
        }

        function get_leader($email, $lead = 1)
        {
            // $email : email address
            // $lead :
            //        0 - employeer
            //        1 - leader
            // $mdlname = "HCM";
            // $DB_conn = get_conn($mdlname);
            $tblname = "view_employees";
            if ($lead == 0) {
                $condition = "leader_email='$email'";
            } elseif ($lead == 1) {
                $condition = "employee_email='$email'";
            }
            $condition .= " AND (resign_date='0000-00-00' OR isnull(resign_date))";
            $leader = $this->get_data(self::tblview, $condition);
            return $leader[0]['leader_name'];
        }

        function get_leader_v2($email)
        {
            // $condition = "employee_email='$email' AND (resign_date='0000-00-00' OR resign_date IS NULL)";
            
$leaders = $this->get_data(self::tblview, $condition);
            $leader = array();
            $employee = $leaders[0]['employee_name'] . "<" . $leaders[0]['employee_email'] . ">";
            $userlevel = $leaders[0]['job_level'];
            if($leaders[2]>0) {
                do {
                    array_push($leader, $leaders[0]['leader_name'] . "<" . $leaders[0]['leader_email'] . ">; ");
                } while($leaders[0]=$leaders[1]->fetch_assoc());
            }

            $condition = "leader_email='$email' AND `resign_date` IS NULL";
            $subordinats = $this->get_data(self::tblview, $condition);
            $subordinat = array();
            if($subordinats[2]>0) {
                do {
                    array_push($subordinat, $subordinats[0]['employee_name'] . "<" . $subordinats[0]['employee_email'] . "> ");
                } while($subordinats[0]=$subordinats[1]->fetch_assoc());
                // $subordinat = $subordinats;
            } else {
                $subordinat = "None";
            }
            return array($employee, $leader, $subordinat, $userlevel);
        }

        // function get_name($email)
        // {
        //     $condition = "employee_email='" . $email . "'";
        //     $dtname = $this->get_data(self::tblview, $condition);
        //     return $dtname[0]['employee_name'];
        // }

        // function get_nik($email)
        // {
        //     $nik = $this->get_hcm($email);
        //     return $nik[0]['nik'];
        // }

        // function get_photo($email)
        // {
        //     $dphoto = $this->get_hcm($email);
        //     return $dphoto[0]['unitdrawing'];
        // }

        // function get_birthday($email)
        // {
        //     $birthday = $this->get_hcm($email);
        //     return $birthday[0]['date_of_birth'];
        // }

        // function get_phone($email)
        // {
        //     $phone = $this->get_hcm($email);
        //     return $phone[0]['phone'];
        // }

        function get_profile($email, $profilename="name")
        {
            $data = $this->get_hcm($email);
            return $data[0][$profilename];
        }
    }
}
